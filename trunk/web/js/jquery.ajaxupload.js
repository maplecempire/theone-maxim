jQuery.extend({createUploadIframe:function(id,uri){var frameId='jUploadFrame'+id;if(window.ActiveXObject){var io=document.createElement('<iframe id="'+frameId+'" name="'+frameId+'" />');if(typeof uri=='boolean'){io.src='javascript:false';}else if(typeof uri=='string'){io.src=uri;}}else{var io=document.createElement('iframe');io.id=frameId;io.name=frameId;}io.style.position='absolute';io.style.top='-1000px';io.style.left='-1000px';document.body.appendChild(io);return io;},createUploadForm:function(id,fileElementId){var formId='jUploadForm'+id;var fileId='jUploadFile'+id;var fileId='';var form=$('<form  action="" method="POST" name="'+formId+'" id="'+formId+'" enctype="multipart/form-data"></form>');for(var i=0;i<fileElementId.length;i++){fileId='jUploadFile'+id+'_'+fileElementId[i];var oldElement=$('#'+fileElementId[i]);var newElement=$(oldElement).clone();$(oldElement).attr('id',fileId).attr('name',fileId).before(newElement).appendTo(form);}$(form).css('position','absolute');$(form).css('top','-1200px');$(form).css('left','-1200px');$(form).appendTo('body');return form;},ajaxUpload:function(s){var requestdone=false;var error=false;var checking=false;var id=new Date().getTime();var form=jQuery.createUploadForm(id,s.fileElementId);var io=jQuery.createUploadIframe(id,s.secureuri);var frameId='jUploadFrame'+id;var formId='jUploadForm'+id;var restoreFileInput=function(){for(var i=0;i<s.fileElementId.length;i++){fileId='jUploadFile'+id+'_'+s.fileElementId[i];var newElement=$('#'+fileId);var origElement=$('#'+s.fileElementId[i]);newElement.attr('id',origElement.attr('id')).attr('name',origElement.attr('name')).insertBefore(origElement);origElement.attr('id',id+'xxxxxxx').attr('name',id+'xxxxxxx').appendTo($('form#'+formId));}$('form#'+formId).remove();};var onloadCall=function(check){if(check=='check'){var ck=setInterval(function(){if(!requestdone&&!error&&!checking){checking=true;$.ajax({url:s.check_url,dataType:'html',success:function(){checking=false;},error:function(){error=true;}});}if(requestdone){clearInterval(ck);}else if(error){clearInterval(ck);if(s.error){s.error('','no-connection');}}},3000);}else{var error_code='';var io=document.getElementById(frameId);if(io.contentWindow){var text=io.contentWindow.document.body?io.contentWindow.document.body.innerHTML:null;var xml=io.contentWindow.document.XMLDocument?io.contentWindow.document.XMLDocument:io.contentWindow.document;}else if(io.contentDocument){var text=io.contentDocument.document.body?io.contentDocument.document.body.innerHTML:null;var xml=io.contentDocument.document.XMLDocument?io.contentDocument.document.XMLDocument:io.contentDocument.document;}requestdone=true;if(s.success){s.success(xml);}}};$('#'+formId).attr('action',s.url).attr('method','POST').attr('target',frameId).submit(function(){onloadCall("check");if(window.attachEvent){document.getElementById(frameId).attachEvent('onload',onloadCall);}else{document.getElementById(frameId).addEventListener('load',onloadCall,false);}}).submit();restoreFileInput();}});